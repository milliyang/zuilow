services:
  web:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    ports:
      - "11182:11182"
    volumes:
      - ..:/app
      - ../run:/app/run
    env_file:
      - ../.env
    environment:
      - FLASK_DEBUG=True
      - FLASK_ENV=development
      # In Docker, set DMS_BASE_URL in .env to reach DMS (e.g. http://mongkok:11183 or http://host.docker.internal:11183).
      - DMS_BASE_URL=${DMS_BASE_URL:-http://mongkok:11183}
      - DMS_API_KEY=${DMS_API_KEY:-your-shared-secret}
    # Resolve hostname "mongkok" to the host so DMS_BASE_URL=http://mongkok:11183 works when DMS runs on the host.
    extra_hosts:
      - "mongkok:host-gateway"
    restart: unless-stopped
