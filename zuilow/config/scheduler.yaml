# Scheduler config
# 市场固有执行时间：HK/US/BTC 各有独立执行任务，到点消费该市场的 pending 信号
# market_open_time + market_timezone 一起定义「该市场开盘时刻」；trigger 只按配置换算，不再在代码里维护市场→时区
markets:
  HK:
    market_open_time: "09:30"
    market_timezone: "Asia/Hong_Kong"
    open_bar_minutes: 5
    enabled: false
  US:
    market_open_time: "09:30"
    market_timezone: "America/New_York"
    open_bar_minutes: 5
    enabled: true
  BTC:
    open_bar_minutes: 60   # 24/7，按小时执行
    enabled: false

scheduler:
  timezone: Asia/Hong_Kong
  enabled: true
  max_workers: 3  # Max concurrent jobs

  jobs:
    # HK market strategy -> account name (see config/accounts.yaml)
    - name: daily_sma
      strategy: SMAStrategy
      config: strategies/sma_daily.yaml
      symbols: [HK.00700, HK.09988]
      trigger: cron
      cron: "30 16 * * 1-5"
      mode: live
      account: "paper-trade-account-01"
      market: HK
      send_immediately: false
      priority: 1
      enabled: false

    # US market strategy -> another account
    - name: intraday_rsi
      strategy: RSIStrategy
      config: strategies/rsi_intraday.yaml
      symbols: [US.AAPL, US.TSLA]
      trigger: interval
      minutes: 30
      mode: live
      account: "paper-trade-account-us02"
      market: US
      send_immediately: false
      priority: 5
      enabled: false

    - name: buy_and_hold_us
      strategy: BuyAndHold
      config: strategies/buy_and_hold.yaml
      symbols: [US.AAPL, US.TSLA]
      trigger: interval
      #minutes: 30
      hours: 5                  # 5小时执行一次
      mode: live
      account: "paper-trade-account-01"
      market: US
      send_immediately: false    # 不立即发送信号，而是写入 SignalStore 等待市场执行
      priority: 5
      enabled: false

    # 收盘后出调仓信号，次日开盘由 exec_US_open 在交易时间执行
    - name: rebalance_after_close
      strategy: RebalanceAfterClose
      config: strategies/rebalance_after_close.yaml
      symbols: [US.AAPL, US.TSLA]
      trigger: cron
      cron: "30 16 * * 1-5"
      mode: live
      account: "paper-trade-account-01"
      market: US
      send_immediately: false
      priority: 5
      enabled: false

    # 测试用：随机 5 只 US 股票、随机权重，每 10 天调仓
    - name: bull5d_random
      strategy: Bull5dRandom
      config: strategies/bull5d_random.yaml
      symbols: []   # 不逐标的跑 on_bar，由 get_rebalance_output 出 allocation
      trigger: interval
      hours: 240    # 10 天
      mode: live
      account: "paper-trade-account-01"
      market: US
      send_immediately: false
      priority: 2                             # High priority
      enabled: true

# Notification (optional)
notification:
  enabled: false  # Enable when needed
  types: [email]       # email, webhook, dingtalk

  notify_on_success: false
  notify_on_failure: true
  notify_on_signal: true

  # See scheduler.example.yaml for full options

  # Webhook
  webhook_url: http://localhost:8080/notifications
  webhook_headers:
    Content-Type: application/json
    Authorization: Bearer your-token

  # Email (optional)
  email_smtp_host: smtp.gmail.com
  email_smtp_port: 465
  email_from: your-email@gmail.com
  email_password: your-password
  email_to:
    - admin@example.com

  # DingTalk (optional)
  dingtalk_webhook: https://oapi.dingtalk.com/robot/send?access_token=xxx
  dingtalk_secret: your-secret
